<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MukallaStay | Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙÙ†Ø¯Ù‚</title>
  <link rel="stylesheet" href="hotel-dashboard.css" />
</head>
<body class="bg">
  <header class="header">
    <div class="container">
      <h1>ğŸ”‘ Ø¯Ø®ÙˆÙ„/ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙÙ†Ø¯Ù‚</h1>
      <p class="muted">Ø§Ø¯Ø®Ù„ Ø¨Ø­Ø³Ø§Ø¨ Ø§Ù„ÙÙ†Ø¯Ù‚ Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§.</p>
    </div>
  </header>

  <main class="container narrow">
    <div class="card tabs">
      <div class="tabbar">
        <button class="tab active" data-target="#login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button class="tab" data-target="#register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      </div>

      <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
      <form id="login" class="form section active">
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input id="loginEmail" type="email" placeholder="hotel@example.com" required />
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input id="loginPassword" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required />
        <button type="submit" class="btn primary full">Ø¯Ø®ÙˆÙ„</button>
      </form>

      <!-- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
      <form id="register" class="form section">
        <label>Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚</label>
        <input id="regName" type="text" placeholder="The View Hotel" required />
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input id="regEmail" type="email" placeholder="hotel@example.com" required />
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input id="regPassword" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù‚ÙˆÙŠØ©" required />
        <button type="submit" class="btn success full">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
      </form>
    </div>

    <div id="toasts"></div>
  </main>

  <script>
    const API = "http://localhost:3000";

    // ØªØ¨ÙˆÙŠØ¨
    document.querySelectorAll(".tab").forEach((t) => {
      t.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
        t.classList.add("active");
        document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
        document.querySelector(t.dataset.target).classList.add("active");
      });
    });

    // ØªÙˆØ³Øª Ø¨Ø³ÙŠØ·
    const toasts = document.getElementById("toasts");
    function toast(msg, type="info") {
      const d = document.createElement("div");
      d.className = "toast " + type;
      d.innerHTML = msg;
      toasts.appendChild(d);
      setTimeout(()=>d.remove(), 3500);
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById("login").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();

      try {
        const r = await fetch(`${API}/api/hotel/login`, {

          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ email, password })
        });
        const j = await r.json();
        if (!r.ok || j.ok === false) throw new Error(j.error || "ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„");

        // Ù†ØªÙˆÙ‚Ù‘Ø¹ Ø£Ù† ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±: { ok:true, hotel:{id,name,email} }
        localStorage.setItem("hotel", JSON.stringify(j.hotel));
        toast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…", "success");
        location.href = "hotel-dashboard.html";
      } catch (err) {
        toast(err.message || "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±", "danger");
      }
    });

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById("register").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("regName").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const password = document.getElementById("regPassword").value.trim();

      try {
        const r = await fetch(`${API}/api/admin/hotel-register`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ name, email, password })
        });
        const j = await r.json();
        if (!r.ok || j.ok === false) throw new Error(j.error || "ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨");

        toast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ… - ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†", "success");
        // ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.querySelector('.tab[data-target="#login"]').click();
      } catch (err) {
        toast(err.message || "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±", "danger");
      }
    });

    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù‘Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§
    const current = localStorage.getItem("hotel");
    if (current) location.href = "hotel-dashboard.html";
  </script>
  <script src="hotel-login.js"></script>

</body>
</html>
